import{_ as s,c as a,o as i,a4 as e}from"./chunks/framework.BmdFiWrL.js";const u=JSON.parse('{"title":"Agent 启动/上线问题自检流程","description":"","frontmatter":{},"headers":[],"relativePath":"guide/q2.md","filePath":"guide/q2.md","lastUpdated":1734158239000}'),t={name:"guide/q2.md"},n=e(`<h1 id="agent-启动-上线问题自检流程" tabindex="-1">Agent 启动/上线问题自检流程 <a class="header-anchor" href="#agent-启动-上线问题自检流程" aria-label="Permalink to &quot;Agent 启动/上线问题自检流程&quot;">​</a></h1><p>如果 Agent 启动后无法正常上线，可按照以下步骤逐步排查问题：</p><hr><h2 id="_1-检查网络连通性" tabindex="-1">1. 检查网络连通性 <a class="header-anchor" href="#_1-检查网络连通性" aria-label="Permalink to &quot;1. 检查网络连通性&quot;">​</a></h2><p>使用以下命令检查本机是否能够连接到面板服务器的通讯端口：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">域名/I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">通讯端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">口</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">telnet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">域名/I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">通讯端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">口</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="注意事项" tabindex="-1">注意事项： <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项：&quot;">​</a></h3><ul><li>如果本机与面板服务器之间无法通信： <ul><li>检查本地和面板服务器的入站/出站防火墙规则。</li><li>可使用 <a href="https://port.ping.pe/" target="_blank" rel="noreferrer">https://port.ping.pe/</a> 提供的端口检查工具，确认端口是否对外开放。</li></ul></li></ul><hr><h2 id="_2-检查-selinux-状态" tabindex="-1">2. 检查 SELinux 状态 <a class="header-anchor" href="#_2-检查-selinux-状态" aria-label="Permalink to &quot;2. 检查 SELinux 状态&quot;">​</a></h2><p>如果网络检测正常，但 Agent 仍无法上线，请尝试关闭 SELinux：</p><h3 id="关闭-selinux-的操作" tabindex="-1">关闭 SELinux 的操作： <a class="header-anchor" href="#关闭-selinux-的操作" aria-label="Permalink to &quot;关闭 SELinux 的操作：&quot;">​</a></h3><ul><li>查看当前 SELinux 状态：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sestatus</span></span></code></pre></div></li><li>临时关闭 SELinux（无需重启）：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div></li><li>永久关闭 SELinux： 编辑 <code>/etc/selinux/config</code> 文件，将 <code>SELINUX=enforcing</code> 修改为：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SELINUX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">disabled</span></span></code></pre></div>然后重启系统。</li></ul><p><a href="https://www.google.com/search?q=%E5%85%B3%E9%97%ADSELINUX" target="_blank" rel="noreferrer">如何关闭 SELinux？</a></p><hr><h2 id="_3-查看-agent-运行日志" tabindex="-1">3. 查看 Agent 运行日志 <a class="header-anchor" href="#_3-查看-agent-运行日志" aria-label="Permalink to &quot;3. 查看 Agent 运行日志&quot;">​</a></h2><p>在配置文件中启用 debug 模式，使用以下命令查看 Agent 的运行状态和日志：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre></div><p>检查日志中的错误信息，定位问题的具体原因。</p><hr><h2 id="_4-检查-grpc-服务通信" tabindex="-1">4. 检查 gRPC 服务通信 <a class="header-anchor" href="#_4-检查-grpc-服务通信" aria-label="Permalink to &quot;4. 检查 gRPC 服务通信&quot;">​</a></h2><p>验证 Agent 是否能够正常连接到 gRPC 服务：</p><h3 id="使用以下命令检查-grpc-服务路径" tabindex="-1">使用以下命令检查 gRPC 服务路径： <a class="header-anchor" href="#使用以下命令检查-grpc-服务路径" aria-label="Permalink to &quot;使用以下命令检查 gRPC 服务路径：&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">你的IP或域</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">名</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">口</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/proto.NezhaService/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type:application/grpc&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><h3 id="正常响应示例" tabindex="-1">正常响应示例： <a class="header-anchor" href="#正常响应示例" aria-label="Permalink to &quot;正常响应示例：&quot;">​</a></h3><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt; HTTP/2 200</span></span>
<span class="line"><span>&lt; content-type: application/grpc</span></span>
<span class="line"><span>&lt;</span></span>
<span class="line"><span>&lt; grpc-message: unknown method  for service proto.NezhaService</span></span>
<span class="line"><span>&lt; grpc-status: 12</span></span></code></pre></div><h3 id="关键信息" tabindex="-1">关键信息： <a class="header-anchor" href="#关键信息" aria-label="Permalink to &quot;关键信息：&quot;">​</a></h3><ol><li><strong><code>content-type</code> 是否为 <code>application/grpc</code></strong>： <ul><li>如果不正确，表示无法正常连接到 gRPC 服务。</li></ul></li><li><strong>是否有 <code>grpc-message</code> 相关的报错信息</strong>： <ul><li>正常情况下应出现 <code>unknown method for service proto.NezhaService</code>。</li></ul></li></ol><h3 id="若检查失败" tabindex="-1">若检查失败： <a class="header-anchor" href="#若检查失败" aria-label="Permalink to &quot;若检查失败：&quot;">​</a></h3><ul><li>检查反向代理配置和流量路径是否正确，确保 gRPC 请求能够成功到达面板服务器。</li></ul>`,30),l=[n];function h(p,r,k,d,o,c){return i(),a("div",null,l)}const F=s(t,[["render",h]]);export{u as __pageData,F as default};

import{_ as s,c as i,o as a,a4 as n}from"./chunks/framework.BmdFiWrL.js";const y=JSON.parse('{"title":"安装 Agent","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/agent.md","filePath":"guide/agent.md","lastUpdated":1756934130000}'),e={name:"guide/agent.md"},l=n(`<h1 id="安装-agent" tabindex="-1">安装 Agent <a class="header-anchor" href="#安装-agent" aria-label="Permalink to &quot;安装 Agent&quot;">​</a></h1><p><strong>哪吒监控的被控端服务被称为 Agent，本文档将介绍如何在被控端服务器上安装 Agent，并与 Dashboard 连接。</strong></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Agent 二进制文件仓库地址为：<a href="https://github.com/nezhahq/agent/releases" target="_blank" rel="noreferrer">https://github.com/nezhahq/agent/releases</a></p></div><h2 id="一键安装-agent" tabindex="-1">一键安装 Agent <a class="header-anchor" href="#一键安装-agent" aria-label="Permalink to &quot;一键安装 Agent&quot;">​</a></h2><p>哪吒监控支持在 Windows、macOS 和 Linux 上一键安装 Agent。遵循本文档的步骤，你可以轻松地在服务器上部署它。</p><h3 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h3><p>在安装前，需要提前在管理面板中设置通信域名，该域名不建议接入 CDN。本文档以示例通信域名 “data.example.com” 为例。</p><ol><li>在后台管理面板点击头像，进入“系统设置”页。</li><li>在“Agent 对接地址【域名/IP:端口】”项中填入通信域名和端口 “data.example.com:8008”。</li><li>点击“确认”保存设置。</li></ol><h3 id="一键安装步骤" tabindex="-1">一键安装步骤 <a class="header-anchor" href="#一键安装步骤" aria-label="Permalink to &quot;一键安装步骤&quot;">​</a></h3><ol><li>在 <code>服务器</code> 页面中，点击 <code>安装命令</code> 并选择对应操作系统，安装命令将自动复制到你的剪贴板。</li><li>在被控端服务器中运行安装命令，等待安装完成后返回到 <code>服务器</code> 页面查看是否上线。</li><li>如果安装成功，页面中将自动弹出新的服务器，你可以点击编辑按钮为其设置名称。</li></ol><h3 id="平台特有说明" tabindex="-1">平台特有说明 <a class="header-anchor" href="#平台特有说明" aria-label="Permalink to &quot;平台特有说明&quot;">​</a></h3><h4 id="windows-特殊说明" tabindex="-1">Windows 特殊说明 <a class="header-anchor" href="#windows-特殊说明" aria-label="Permalink to &quot;Windows 特殊说明&quot;">​</a></h4><ol><li>在 Windows 服务器中，运行 PowerShell。</li><li>在 PowerShell 中粘贴并运行安装命令。</li><li>如遇到「执行策略变更」确认提示，输入 <code>Y</code> 并回车。</li></ol><h2 id="其他方式安装-agent" tabindex="-1">其他方式安装 Agent <a class="header-anchor" href="#其他方式安装-agent" aria-label="Permalink to &quot;其他方式安装 Agent&quot;">​</a></h2><hr><h3 id="在群晖系统中安装-agent-dsm-7" tabindex="-1">在群晖系统中安装 Agent（DSM 7） <a class="header-anchor" href="#在群晖系统中安装-agent-dsm-7" aria-label="Permalink to &quot;在群晖系统中安装 Agent（DSM 7）&quot;">​</a></h3><details><summary>点击展开/收起</summary><p>由于群晖（Synology NAS）设备的系统基于特定版本的 Linux，其 shell 环境和软件包管理与标准 Linux 系统有所不同，因此不支持一键安装脚本。需要手动安装 Agent，具体步骤如下：</p><hr><h4 id="_1-准备工作" tabindex="-1">1. 准备工作 <a class="header-anchor" href="#_1-准备工作" aria-label="Permalink to &quot;1. 准备工作&quot;">​</a></h4><ol><li><p><strong>确保拥有管理员权限</strong></p><ul><li>登录群晖的管理界面，或通过 SSH 使用管理员账户登录设备。</li></ul></li><li><p><strong>安装必要的依赖</strong><br> 确定群晖设备已安装 <code>wget</code>、<code>unzip</code> 或 <code>curl</code></p></li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>也可以提前下载并解压好 Nezha Agent 的二进制文件，通过群晖的 DSM File Station 手动上传，免去安装依赖的步骤。</p></div><hr><h4 id="_2-下载-nezha-agent" tabindex="-1">2. 下载 Nezha Agent <a class="header-anchor" href="#_2-下载-nezha-agent" aria-label="Permalink to &quot;2. 下载 Nezha Agent&quot;">​</a></h4><ol><li><p><strong>确定群晖的 CPU 架构</strong><br> 使用以下命令获取设备的架构信息：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span></span></code></pre></div><p>常见架构对应关系：</p><ul><li><code>x86_64</code> 对应 <code>amd64</code></li><li><code>armv7l</code> 或 <code>aarch64</code> 对应 <code>arm</code></li></ul></li><li><p><strong>下载适配的 Nezha Agent 二进制文件</strong><br> 根据设备架构选择正确的下载链接。例如，对于 <code>amd64</code> 架构：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent.zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/nezhahq/agent/releases/latest/download/nezha-agent_linux_amd64.zip</span></span></code></pre></div></li><li><p><strong>解压文件</strong><br> 将下载的压缩包解压到指定目录，例如 <code>/opt/nezha</code>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nezha</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent.zip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nezha</span></span></code></pre></div></li><li><p><strong>赋予运行权限</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nezha/nezha-agent</span></span></code></pre></div></li></ol><hr><h4 id="_3-创建配置文件" tabindex="-1">3. 创建配置文件 <a class="header-anchor" href="#_3-创建配置文件" aria-label="Permalink to &quot;3. 创建配置文件&quot;">​</a></h4><ol><li><strong>创建并编辑配置文件</strong><br> 在 <code>/opt/nezha</code> 目录下创建 <code>config.yml</code> 文件，并添加以下内容：<div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">client_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_agent_secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_auto_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_command_execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_force_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_nat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_send_query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">insecure_tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ip_report_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1800</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">report_delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data.example.com:8008</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_connection_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_procs_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">temperature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_gitee_to_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_ipv6_country_code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_uuid</span></span></code></pre></div><ul><li><strong>字段说明</strong>： <ul><li><code>server</code>：替换为 Dashboard 地址和端口，如 <code>data.example.com:8008</code> <code>1.1.1.1:8008</code> <code>&quot;[2606:4700:4700::1111]:8008&quot;</code>。</li><li><code>client_secret</code>：替换为 Dashboard 配置文件中的 <code>agentsecretkey</code>，路径通常为 <code>/opt/nezha/dashboard/data/config.yaml</code>。</li><li><code>uuid</code>：为该 Agent 生成一个唯一标识符，不要与同一个 Dashboard 中其他的 Agent 重复，可使用 <code>uuidgen</code> 命令生成：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uuidgen</span></span></code></pre></div></li></ul></li><li><strong>保存文件</strong>：将文件保存至 <code>/opt/nezha/config.yml</code>。</li></ul></li></ol><hr><h4 id="_4-创建-systemctl-服务文件" tabindex="-1">4. 创建 systemctl 服务文件 <a class="header-anchor" href="#_4-创建-systemctl-服务文件" aria-label="Permalink to &quot;4. 创建 systemctl 服务文件&quot;">​</a></h4><ol><li><p><strong>创建服务文件</strong><br> 在 <code>/etc/systemd/system/</code> 目录下创建 <code>nezha-agent.service</code> 文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/nezha-agent.service</span></span></code></pre></div></li><li><p><strong>添加以下内容</strong>：</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=Nezha Agent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">After</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=simple</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/opt/nezha/nezha-agent -c /opt/nezha/config.yml</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=always</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestartSec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WantedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=multi-user.target</span></span></code></pre></div></li><li><p><strong>保存文件并重新加载服务配置</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span></code></pre></div></li></ol><hr><h4 id="_5-启动-agent" tabindex="-1">5. 启动 Agent <a class="header-anchor" href="#_5-启动-agent" aria-label="Permalink to &quot;5. 启动 Agent&quot;">​</a></h4><ol><li><p><strong>启动服务</strong><br> 使用以下命令启动 Agent：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span></code></pre></div></li><li><p><strong>设置开机自启动</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span></code></pre></div></li><li><p><strong>查看服务状态</strong><br> 确保 Agent 已成功启动：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span></code></pre></div></li></ol><hr><h4 id="_6-验证-agent-连接" tabindex="-1">6. 验证 Agent 连接 <a class="header-anchor" href="#_6-验证-agent-连接" aria-label="Permalink to &quot;6. 验证 Agent 连接&quot;">​</a></h4><ol><li>登录 Dashboard，检查是否有新设备上线。</li><li>如果服务运行正常且日志中无报错，则安装完成。</li></ol></details><hr><h3 id="在-windows-系统中手动安装-agent" tabindex="-1">在 Windows 系统中手动安装 Agent <a class="header-anchor" href="#在-windows-系统中手动安装-agent" aria-label="Permalink to &quot;在 Windows 系统中手动安装 Agent&quot;">​</a></h3><details><summary>点击展开/收起</summary><p>Windows 系统除了一键脚本，也可以下载对应的二进制文件并手动配置，以下是详细步骤：</p><hr><h4 id="_1-准备工作-1" tabindex="-1">1. 准备工作 <a class="header-anchor" href="#_1-准备工作-1" aria-label="Permalink to &quot;1. 准备工作&quot;">​</a></h4><ol><li><p><strong>确保管理员权限</strong><br> 使用管理员账户登录 Windows 系统。</p></li><li><p><strong>安装必要工具</strong></p><ul><li>确保有解压工具（如 <code>7-Zip</code> 或 <code>WinRAR</code>）。</li></ul></li></ol><hr><h4 id="_2-下载-nezha-agent-1" tabindex="-1">2. 下载 Nezha Agent <a class="header-anchor" href="#_2-下载-nezha-agent-1" aria-label="Permalink to &quot;2. 下载 Nezha Agent&quot;">​</a></h4><ol><li><p><strong>确认系统架构</strong></p><ul><li>Windows 系统一般为 <code>amd64</code> 架构，可直接下载对应的二进制文件。</li></ul></li><li><p><strong>下载 Nezha Agent 文件</strong></p><ul><li>访问 <a href="https://github.com/nezhahq/agent/releases" target="_blank" rel="noreferrer">Nezha Agent Releases</a>，下载适用于 <code>Windows</code> 的版本，例如：<div class="language-plaintext vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nezha-agent_windows_amd64.zip</span></span></code></pre></div></li></ul></li><li><p><strong>解压文件</strong></p><ul><li>将下载的压缩包解压到指定目录，例如：<code>C:\\nezha</code>。</li></ul></li></ol><hr><h4 id="_3-创建配置文件-1" tabindex="-1">3. 创建配置文件 <a class="header-anchor" href="#_3-创建配置文件-1" aria-label="Permalink to &quot;3. 创建配置文件&quot;">​</a></h4><ol><li><p><strong>创建并编辑配置文件</strong><br> 在解压目录中创建 <code>config.yml</code> 文件，内容如下：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">client_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_agent_secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_auto_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_command_execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_force_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_nat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_send_query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">insecure_tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ip_report_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1800</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">report_delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data.example.com:8008</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_connection_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_procs_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">temperature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_gitee_to_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_ipv6_country_code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_uuid</span></span></code></pre></div><ul><li><strong>字段说明</strong>： <ul><li><code>server</code>：替换为您的 Dashboard 地址和端口，例如 <code>data.example.com:8008</code> <code>1.1.1.1:8008</code> <code>&quot;[2606:4700:4700::1111]:8008&quot;</code>。</li><li><code>client_secret</code>：替换为 Dashboard 的 <code>agentsecretkey</code>，通常位于 <code>/opt/nezha/dashboard/data/config.yaml</code> 文件中。</li><li><code>uuid</code>：可以通过在线工具生成。</li></ul></li></ul></li><li><p><strong>保存文件</strong><br> 将文件保存为 <code>config.yml</code>，存放在 Agent 的目录中。</p></li></ol><hr><h4 id="_4-运行-agent" tabindex="-1">4. 运行 Agent <a class="header-anchor" href="#_4-运行-agent" aria-label="Permalink to &quot;4. 运行 Agent&quot;">​</a></h4><ol><li><p><strong>以管理员权限运行 Agent</strong><br> 打开命令提示符，进入 Agent 的目录并运行以下命令：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nezha-agent.exe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c config.yml</span></span></code></pre></div></li><li><p><strong>验证连接</strong></p><ul><li>登录 Dashboard，查看是否有新设备上线。</li><li>如果日志中没有报错信息，说明安装成功。</li></ul></li></ol><hr><h4 id="_5-设置为服务运行" tabindex="-1">5. 设置为服务运行 <a class="header-anchor" href="#_5-设置为服务运行" aria-label="Permalink to &quot;5. 设置为服务运行&quot;">​</a></h4><ol><li><p><strong>安装为服务</strong></p><ul><li>进入 Agent 的目录，在命令提示符中运行：<div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nezha-agent.exe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service install</span></span></code></pre></div></li></ul></li><li><p><strong>启动服务</strong></p><ul><li>安装成功后，Agent 会自动以服务形式启动，重启系统时也会自动运行。</li></ul></li><li><p><strong>卸载服务</strong></p><ul><li>如需卸载服务，运行以下命令：<div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nezha-agent.exe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service uninstall</span></span></code></pre></div></li></ul></li></ol></details><hr><h3 id="在-openwrt-系统中安装-agent" tabindex="-1">在 OpenWrt 系统中安装 Agent <a class="header-anchor" href="#在-openwrt-系统中安装-agent" aria-label="Permalink to &quot;在 OpenWrt 系统中安装 Agent&quot;">​</a></h3><details><summary>点击展开/收起</summary><p>OpenWrt 是轻量级 Linux 系统，需通过手动下载和配置安装 Nezha Agent。</p><hr><h4 id="_1-准备工作-2" tabindex="-1">1. 准备工作 <a class="header-anchor" href="#_1-准备工作-2" aria-label="Permalink to &quot;1. 准备工作&quot;">​</a></h4><ol><li><p><strong>确保管理员权限</strong></p><ul><li>通过 SSH 登录到 OpenWrt，使用 <code>root</code> 账户操作。</li></ul></li><li><p><strong>安装必要工具</strong></p><ul><li>更新软件包列表并安装必要工具：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unzip</span></span></code></pre></div></li></ul></li></ol><hr><h4 id="_2-下载-nezha-agent-2" tabindex="-1">2. 下载 Nezha Agent <a class="header-anchor" href="#_2-下载-nezha-agent-2" aria-label="Permalink to &quot;2. 下载 Nezha Agent&quot;">​</a></h4><ol><li><p><strong>确定系统架构</strong><br> 使用以下命令获取架构信息：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span></span></code></pre></div><p>常见架构对应关系：</p><ul><li><code>x86_64</code> 对应 <code>nezha-agent_linux_amd64.zip</code></li><li><code>arm</code> 或 <code>aarch64</code> 对应 <code>nezha-agent_linux_arm.zip</code></li></ul></li><li><p><strong>下载适配的 Nezha Agent</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent.zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/nezhahq/agent/releases/latest/download/nezha-agent_linux_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.zip</span></span></code></pre></div></li><li><p><strong>解压文件</strong><br> 解压文件至 <code>/etc/nezha</code> 目录：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent.zip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha</span></span></code></pre></div></li></ol><hr><h4 id="_3-创建配置文件-2" tabindex="-1">3. 创建配置文件 <a class="header-anchor" href="#_3-创建配置文件-2" aria-label="Permalink to &quot;3. 创建配置文件&quot;">​</a></h4><ol><li><p><strong>创建配置文件</strong><br> 创建并编辑 <code>/etc/nezha/config.yml</code> 文件并填入以下内容：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/config.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/config.yml</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">client_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_agent_secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_auto_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_command_execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_force_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_nat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_send_query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">insecure_tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ip_report_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1800</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">report_delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data.example.com:8008</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_connection_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">skip_procs_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">temperature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_gitee_to_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">use_ipv6_country_code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_uuid</span></span></code></pre></div><ul><li><strong>字段说明</strong>： <ul><li><code>server</code>：替换为您的 Dashboard 地址和端口，例如 <code>data.example.com:8008</code> <code>1.1.1.1:8008</code> <code>&quot;[2606:4700:4700::1111]:8008&quot;</code>。</li><li><code>client_secret</code>：替换为 Dashboard 的 <code>agentsecretkey</code>，通常位于 <code>/opt/nezha/dashboard/data/config.yaml</code> 文件中。</li><li><code>uuid</code>：可以通过在线工具生成。</li></ul></li></ul></li><li><p><strong>保存配置文件</strong><br> 确保配置文件路径正确：<code>/etc/nezha/config.yml</code>。</p></li></ol><hr><h4 id="_4-运行-agent-1" tabindex="-1">4. 运行 Agent <a class="header-anchor" href="#_4-运行-agent-1" aria-label="Permalink to &quot;4. 运行 Agent&quot;">​</a></h4><ol><li><p><strong>赋予执行权限并启动 Agent</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/nezha-agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/nezha/nezha-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/config.yml</span></span></code></pre></div></li><li><p><strong>验证 Agent 连接</strong></p><ul><li>登录 Dashboard 检查是否有新设备上线。</li><li>确认 Agent 运行状态正常。</li></ul></li></ol><hr><h4 id="_5-设置为开机自启动" tabindex="-1">5. 设置为开机自启动 <a class="header-anchor" href="#_5-设置为开机自启动" aria-label="Permalink to &quot;5. 设置为开机自启动&quot;">​</a></h4><p>在 OpenWrt 上，可以通过创建服务脚本的方式实现 Nezha Agent 开机自启动。</p><hr><ol><li><p><strong>创建服务脚本</strong><br> 在 <code>/etc/init.d/nezha-service</code> 中创建一个服务脚本：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/init.d/nezha-service</span></span></code></pre></div></li><li><p><strong>添加以下内容</strong><br> 将以下内容复制到文件中，并根据需求修改 <code>nezha-agent</code> 的路径和配置文件路径：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/sh /etc/rc.common</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">START</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">99</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">USE_PROCD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start_service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    procd_open_instance</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    procd_set_param</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/nezha-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nezha/config.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    procd_set_param</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> respawn</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    procd_close_instance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop_service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    killall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    sleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    start</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><strong>赋予执行权限</strong><br> 保存文件后，赋予脚本执行权限：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/init.d/nezha-service</span></span></code></pre></div></li><li><p><strong>启用服务</strong><br> 运行以下命令启用并启动服务：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nezha-service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nezha-service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre></div></li><li><p><strong>验证启动状态</strong><br> 使用以下命令检查服务是否正常运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span></code></pre></div></li></ol><hr><h4 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h4><ul><li><strong>配置文件路径</strong>：确保脚本中配置文件的路径（如 <code>/etc/nezha/config.yml</code>）正确。</li><li><strong>服务管理</strong>：可以使用以下命令管理服务： <ul><li>手动启动服务：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nezha-service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre></div></li><li>停止服务：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nezha-service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span></span></code></pre></div></li><li>重启服务：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nezha-service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span></span></code></pre></div></li></ul></li><li><strong>日志排查</strong>：如 Agent 无法正常启动，可通过 <code>logread</code> 检查相关日志。</li></ul></details><hr><h2 id="卸载-agent" tabindex="-1">卸载 Agent <a class="header-anchor" href="#卸载-agent" aria-label="Permalink to &quot;卸载 Agent&quot;">​</a></h2><p>卸载 Agent 包括停止服务、卸载服务，以及删除相关文件。以下是 Ubuntu 系统的卸载步骤：</p><ol><li><p>停止并卸载服务：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nezha/agent/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./nezha-agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span></span></code></pre></div></li><li><p>删除 Agent 文件夹：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nezha/agent/</span></span></code></pre></div></li></ol><p>如果安装了多个服务并想要全部卸载，可以使用 Agent 安装脚本的卸载功能：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./agent.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span></span></code></pre></div><hr><h2 id="重新安装并指定-agent-的-uuid" tabindex="-1">重新安装并指定 Agent 的 UUID <a class="header-anchor" href="#重新安装并指定-agent-的-uuid" aria-label="Permalink to &quot;重新安装并指定 Agent 的 UUID&quot;">​</a></h2><p>添加参数 UUID 让新的 Agent 连接后会继承原有的服务器记录和配置。</p><h3 id="操作步骤" tabindex="-1">操作步骤 <a class="header-anchor" href="#操作步骤" aria-label="Permalink to &quot;操作步骤&quot;">​</a></h3><ol><li><p><strong>复制服务器的 UUID</strong><br> 进入 Dashboard，找到目标服务器并获取其对应的 UUID。</p></li><li><p><strong>生成安装命令并添加 UUID</strong><br> 在生成的安装命令中，添加 <code>NZ_UUID=服务器的UUID</code> 参数。这样可以确保 Agent 正确绑定到指定的服务器记录。</p></li><li><p><strong>确认是否卸载旧 Agent</strong><br> 如果服务器上已有 Agent，请确保卸载旧的 Agent，避免重复注册或冲突。</p></li></ol><h3 id="示例安装命令" tabindex="-1">示例安装命令 <a class="header-anchor" href="#示例安装命令" aria-label="Permalink to &quot;示例安装命令&quot;">​</a></h3><p>以下是一个带有 UUID 参数的完整安装命令示例：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/nezhahq/scripts/main/agent/install.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NZ_SERVER=dashboard.example.com:8008</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NZ_TLS=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NZ_CLIENT_SECRET=EXAMPLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NZ_UUID=your_server_uuid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./agent.sh</span></span></code></pre></div><p>将 <code>your_server_uuid</code> 替换为目标服务器的实际 UUID。</p>`,38),t=[l];function h(p,k,d,r,o,g){return a(),i("div",null,t)}const F=s(e,[["render",h]]);export{y as __pageData,F as default};

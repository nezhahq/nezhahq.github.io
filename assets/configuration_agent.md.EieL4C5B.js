import{_ as e,c as a,o as i,a4 as t}from"./chunks/framework.BmdFiWrL.js";const k=JSON.parse('{"title":"Agent 配置","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"configuration/agent.md","filePath":"configuration/agent.md","lastUpdated":1744415290000}'),l={name:"configuration/agent.md"},s=t('<h1 id="agent-配置" tabindex="-1">Agent 配置 <a class="header-anchor" href="#agent-配置" aria-label="Permalink to &quot;Agent 配置&quot;">​</a></h1><p>Agent 配置文件格式为 YAML。</p><p>在管理后台中，可以对 Agent 的配置进行修改并直接应用；也可以通过 API 批量下发配置项，详见 <a href="/developer/api.html">API 文档</a>。</p><hr><h2 id="选项" tabindex="-1">选项 <a class="header-anchor" href="#选项" aria-label="Permalink to &quot;选项&quot;">​</a></h2><ul><li><h5 id="client-secret" tabindex="-1"><strong><code>client_secret</code></strong> <a class="header-anchor" href="#client-secret" aria-label="Permalink to &quot;**`client_secret`**&quot;">​</a></h5><ul><li>用于与 Dashboard 进行安全通信的客户端密钥。</li><li>此参数必须与 Dashboard 中的配置相同，否则 Agent 无法正常与服务器通信。</li></ul></li><li><h5 id="debug" tabindex="-1"><strong><code>debug</code></strong> <a class="header-anchor" href="#debug" aria-label="Permalink to &quot;**`debug`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时启用日志。</li></ul></li><li><h5 id="disable-auto-update" tabindex="-1"><strong><code>disable_auto_update</code></strong> <a class="header-anchor" href="#disable-auto-update" aria-label="Permalink to &quot;**`disable_auto_update`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时禁用 Agent 的自动更新功能，增强系统稳定性和安全性。</li></ul></li><li><h5 id="disable-command-execute" tabindex="-1"><strong><code>disable_command_execute</code></strong> <a class="header-anchor" href="#disable-command-execute" aria-label="Permalink to &quot;**`disable_command_execute`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时 Agent 不再接受面板下达的 <strong>命令执行</strong>、<strong>在线终端</strong> 和 <strong>文件列表</strong> 任务。</li></ul></li><li><h5 id="disable-force-update" tabindex="-1"><strong><code>disable_force_update</code></strong> <a class="header-anchor" href="#disable-force-update" aria-label="Permalink to &quot;**`disable_force_update`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时禁用强制更新功能，仅允许手动更新。</li></ul></li><li><h5 id="disable-nat" tabindex="-1"><strong><code>disable_nat</code></strong> <a class="header-anchor" href="#disable-nat" aria-label="Permalink to &quot;**`disable_nat`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时 Agent 不再接受面板下达的 <strong>内网穿透</strong> 任务。</li></ul></li><li><h5 id="disable-send-query" tabindex="-1"><strong><code>disable_send_query</code></strong> <a class="header-anchor" href="#disable-send-query" aria-label="Permalink to &quot;**`disable_send_query`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时 Agent 不再接受面板下达的 <code>TCP Ping</code>、<code>ICMP Ping</code> 和 <code>HTTP GET</code> 任务。</li></ul></li><li><h5 id="gpu" tabindex="-1"><strong><code>gpu</code></strong> <a class="header-anchor" href="#gpu" aria-label="Permalink to &quot;**`gpu`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时启用 GPU 监控。</li><li>注意：启用 GPU 监控可能需要安装额外依赖，详细信息参考：<a href="/guide/q9.html">启用 GPU 监控</a>。</li></ul></li><li><h5 id="insecure-tls" tabindex="-1"><strong><code>insecure_tls</code></strong> <a class="header-anchor" href="#insecure-tls" aria-label="Permalink to &quot;**`insecure_tls`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时禁用证书检查，适用于使用自签名证书的场景。</li></ul></li><li><h5 id="ip-report-period" tabindex="-1"><strong><code>ip_report_period</code></strong> <a class="header-anchor" href="#ip-report-period" aria-label="Permalink to &quot;**`ip_report_period`**&quot;">​</a></h5><ul><li>设置本地 IP 更新间隔时间（秒）。默认值为 <code>1800</code> 秒（30 分钟）。</li><li>最低有效值为 30 秒。</li></ul></li><li><h5 id="report-delay" tabindex="-1"><strong><code>report_delay</code></strong> <a class="header-anchor" href="#report-delay" aria-label="Permalink to &quot;**`report_delay`**&quot;">​</a></h5><ul><li>设置系统信息上报的时间间隔（秒）。默认值为 <code>3</code> 秒（有效范围：1-4 秒）。</li></ul></li><li><h5 id="server" tabindex="-1"><strong><code>server</code></strong> <a class="header-anchor" href="#server" aria-label="Permalink to &quot;**`server`**&quot;">​</a></h5><ul><li>与 Dashboard 通信的域名或 IP 地址，需包括端口号。</li></ul></li><li><h5 id="skip-connection-count" tabindex="-1"><strong><code>skip_connection_count</code></strong> <a class="header-anchor" href="#skip-connection-count" aria-label="Permalink to &quot;**`skip_connection_count`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时禁用网络连接数的监控，适用于高连接数或资源受限的环境。</li></ul></li><li><h5 id="skip-procs-count" tabindex="-1"><strong><code>skip_procs_count</code></strong> <a class="header-anchor" href="#skip-procs-count" aria-label="Permalink to &quot;**`skip_procs_count`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时禁用进程数的监控，以降低资源占用。</li></ul></li><li><h5 id="temperature" tabindex="-1"><strong><code>temperature</code></strong> <a class="header-anchor" href="#temperature" aria-label="Permalink to &quot;**`temperature`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时启用硬件温度监控（仅支持部分硬件，部分 VPS 可能无法获取温度信息）。</li></ul></li><li><h5 id="tls" tabindex="-1"><strong><code>tls</code></strong> <a class="header-anchor" href="#tls" aria-label="Permalink to &quot;**`tls`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时启用 Agent 与 Dashboard 间的通信 SSL/TLS 加密。</li><li>如果 Agent 使用 Nginx 反向代理且启用了 SSL/TLS 配置，请开启此选项。</li></ul></li><li><h5 id="hard-drive-partition-allowlist" tabindex="-1"><strong><code>hard_drive_partition_allowlist</code></strong> <a class="header-anchor" href="#hard-drive-partition-allowlist" aria-label="Permalink to &quot;**`hard_drive_partition_allowlist`**&quot;">​</a></h5><ul><li>一个字符串数组，用于指定需要监控的硬盘分区列表。</li><li>若指定此参数，将仅对列出的分区进行监控。</li></ul></li><li><h5 id="nic-allowlist" tabindex="-1"><strong><code>nic_allowlist</code></strong> <a class="header-anchor" href="#nic-allowlist" aria-label="Permalink to &quot;**`nic_allowlist`**&quot;">​</a></h5><ul><li>一个 <code>map[string]bool</code> 类型的允许列表，用于指定需要监控的网卡。</li><li>键为网卡名称，值为 <code>true</code> 表示允许监控，<code>false</code> 表示不监控。</li><li>若不指定或为空，则默认监控所有可用网卡。</li></ul></li><li><h5 id="use-gitee-to-upgrade" tabindex="-1"><strong><code>use_gitee_to_upgrade</code></strong> <a class="header-anchor" href="#use-gitee-to-upgrade" aria-label="Permalink to &quot;**`use_gitee_to_upgrade`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时使用 Gitee 仓库作为自动更新源，对中国大陆服务器更为友好。</li></ul></li><li><h5 id="use-ipv6-country-code" tabindex="-1"><strong><code>use_ipv6_country_code</code></strong> <a class="header-anchor" href="#use-ipv6-country-code" aria-label="Permalink to &quot;**`use_ipv6_country_code`**&quot;">​</a></h5><ul><li>当为 <code>true</code> 时强制使用 IPv6 地址查询国家代码（默认使用 IPv4）。</li></ul></li><li><h5 id="uuid" tabindex="-1"><strong><code>uuid</code></strong> <a class="header-anchor" href="#uuid" aria-label="Permalink to &quot;**`uuid`**&quot;">​</a></h5><ul><li>当前 Agent 的唯一标识参数，用于 Dashboard 识别数据来源。</li><li>若需替换 Dashboard 中已存在的 Agent，可以手动设置此参数。</li></ul></li><li><h5 id="dns" tabindex="-1"><strong><code>dns</code></strong> <a class="header-anchor" href="#dns" aria-label="Permalink to &quot;**`dns`**&quot;">​</a></h5><ul><li>一个字符串数组，用于设置自定义 DNS 服务器列表。</li><li>指定后，Agent 将优先使用此列表中的 DNS 服务器解析域名。</li></ul></li><li><h5 id="custom-ip-api" tabindex="-1"><strong><code>custom_ip_api</code></strong> <a class="header-anchor" href="#custom-ip-api" aria-label="Permalink to &quot;**`custom_ip_api`**&quot;">​</a></h5><ul><li>一个字符串数组，用于指定自定义 IP 查询 API 列表。</li><li>Agent 将通过这些 API 获取服务器的公网 IP 信息。</li></ul></li><li><h5 id="self-update-period" tabindex="-1"><strong><code>self_update_period</code></strong> <a class="header-anchor" href="#self-update-period" aria-label="Permalink to &quot;**`self_update_period`**&quot;">​</a></h5><ul><li>手动设置更新间隔（分钟）。</li><li>默认为 30 到 90 之间的随机值。</li></ul></li></ul><hr><h2 id="应用" tabindex="-1">应用 <a class="header-anchor" href="#应用" aria-label="Permalink to &quot;应用&quot;">​</a></h2><p>在修改配置文件中的参数后，需要重新启动 Agent 服务以使更改生效。可以使用 Agent 的内置服务管理功能或者手动重启。</p><h3 id="使用内置服务管理" tabindex="-1">使用内置服务管理 <a class="header-anchor" href="#使用内置服务管理" aria-label="Permalink to &quot;使用内置服务管理&quot;">​</a></h3><p>可以直接输入以下命令重启默认 Agent 服务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span></span></code></pre></div><p>对于多个 Agent 服务的情况，可以指定对应的配置文件：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./config-6sc1f.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span></span></code></pre></div><h3 id="手动管理" tabindex="-1">手动管理 <a class="header-anchor" href="#手动管理" aria-label="Permalink to &quot;手动管理&quot;">​</a></h3><ol><li><p><strong>重新启动服务</strong><br> 运行以下命令重新启动默认的第一个 Agent 服务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent.service</span></span></code></pre></div></li><li><p><strong>多 Agent 服务的情况</strong><br> 如果同一服务器上运行了多个 Agent 服务，请先列出所有 Agent 服务的名称：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-units</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --type=service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nezha-agent</span></span></code></pre></div><p>然后分别使用以下命令重新启动对应的 Agent 服务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>将 <code>&lt;service-name&gt;</code> 替换为实际的服务名称，例如 <code>nezha-agent@2.service</code>。</p></li></ol>',16),o=[s];function r(n,d,c,h,u,p){return i(),a("div",null,o)}const b=e(l,[["render",r]]);export{k as __pageData,b as default};

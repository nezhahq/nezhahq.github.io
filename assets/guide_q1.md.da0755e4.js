import{_ as s,o as a,c as n,R as l}from"./chunks/framework.1625126e.js";const F=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/q1.md","filePath":"guide/q1.md","lastUpdated":1691456305000}'),p={name:"guide/q1.md"},o=l(`<h2 id="å‡†å¤‡å·¥ä½œ" tabindex="-1">å‡†å¤‡å·¥ä½œ <a class="header-anchor" href="#å‡†å¤‡å·¥ä½œ" aria-label="Permalink to &quot;å‡†å¤‡å·¥ä½œ&quot;">â€‹</a></h2><p><strong>ä½ å¯ä»¥é€‰æ‹© CloudFlare çš„ workers è¿›è¡Œåä»£ï¼Œä½†å¤§é™†çš„ç½‘ç»œä½ æ‡‚çš„ï¼Œè¿™é‡Œä»‹ç»ç”¨ä½ è‡ªå·±æœåŠ¡å™¨åä»£æ–¹å¼</strong><br> æ­å»ºä¸€ä¸ª TGbot api åä»£ï¼Œä½ éœ€è¦ï¼š<br> 1.ä¸€ä¸ªä¸å— GFW å°é”çš„æœåŠ¡å™¨(ä¸”å®‰è£…å¥½ Nginx)<br> 2.ä¸€ä¸ªåŸŸå(æå‰ç”³è¯· SSL è¯ä¹¦) <br></p><h2 id="nginx-é…ç½®" tabindex="-1">NGINX é…ç½® <a class="header-anchor" href="#nginx-é…ç½®" aria-label="Permalink to &quot;NGINX é…ç½®&quot;">â€‹</a></h2><p>ç¼–è¾‘ä½  Nginx çš„é…ç½®æ–‡ä»¶,åœ¨ http{} ä¸­åŠ ä¸Šå¦‚ä¸‹é…ç½®</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># httpå¼ºåˆ¶è·³è½¬åˆ°htpps</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">[::]:80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">yourDomainName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Enforce HTTPS</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">301</span><span style="color:#A6ACCD;"> https://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">server_name</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## https</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">443 ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">[::]:443 ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">yourDomainName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## sslå¯†é’¥è·¯å¾„è‡ªå·±æ”¹æ”¹</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_certificate </span><span style="color:#A6ACCD;">server.pem</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_certificate_key </span><span style="color:#A6ACCD;">server.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## rootéå¿…è¦</span></span>
<span class="line"><span style="color:#89DDFF;">	root </span><span style="color:#A6ACCD;">/var/www/tgbot/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## dnså¿…é¡»å†™ï¼Œä¸ç„¶ä¼šæŠ¥502é”™è¯¯</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> resolver </span><span style="color:#A6ACCD;">8.8.8.8</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## ä»¥botå¼€å¤´çš„è¯·æ±‚éƒ½ä¼šè¢«æ­£åˆ™åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/bot </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">	proxy_buffering </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;"> https://api.telegram.org</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## å’Œä¸Šé¢rootä¸€æ ·éå¿…è¦ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥ç¡®è®¤æœåŠ¡å™¨çŠ¶æ€çš„ã€‚ä¹Ÿå¯ä»¥æ”¹æˆreturn 403</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/</span><span style="color:#A6ACCD;">{ </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">	try_files </span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri /index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## no log no fix</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">   /var/log/tg.log </span><span style="color:#89DDFF;"> error;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p><code>yourDomainName</code> - ä½ å‡†å¤‡çš„åŸŸå<br><code>ssl_certificate</code> - SSL è¯ä¹¦è·¯å¾„<br><code>ssl_certificate_key</code> - SSL è¯ä¹¦è·¯å¾„<br><br></p><h2 id="ä½¿ç”¨æ–¹å¼" tabindex="-1">ä½¿ç”¨æ–¹å¼ <a class="header-anchor" href="#ä½¿ç”¨æ–¹å¼" aria-label="Permalink to &quot;ä½¿ç”¨æ–¹å¼&quot;">â€‹</a></h2><p>ğŸ‰ç„¶åæ‰§è¡Œ <code>systemctl restart nginx</code> å›åˆ° Nezha å°†åŸæ¥çš„<a href="https://api.telegram.org/" target="_blank" rel="noreferrer">https://api.telegram.org/</a> æ›¿æ¢ä¸º <a href="https://yourDomainName/" target="_blank" rel="noreferrer">https://yourDomainName/</a> ,å³å¯æ­£å¸¸æ¨é€æ¶ˆæ¯ <br></p><h2 id="é˜²æ­¢ç›—ç”¨" tabindex="-1">é˜²æ­¢ç›—ç”¨ <a class="header-anchor" href="#é˜²æ­¢ç›—ç”¨" aria-label="Permalink to &quot;é˜²æ­¢ç›—ç”¨&quot;">â€‹</a></h2><p><code>serverIp</code> - Agent çš„ ip åœ°å€,ä½ ç³»ç»Ÿå®‰è£…çš„å“ªä¸ªå°±ç”¨å“ªä¸ªå‘½ä»¤,ufw iptables éƒ½å¯.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#ubuntu</span></span>
<span class="line"><span style="color:#FFCB6B;">ufw</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">allow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proto</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serverIp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">any</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">443</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#centos</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-I</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DROP</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-I</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serverIp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ACCEPT</span></span></code></pre></div>`,11),e=[o];function t(r,c,C,y,D,A){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{F as __pageData,d as default};

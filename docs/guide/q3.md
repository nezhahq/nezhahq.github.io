# 反向代理 面板

新版本不再区分Dashboard、gRPC端口，只有默认的8008端口。

- Nginx 配置 示例
    ```nginx
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;
        #http2 on; # Nginx > 1.25.1 就把上面的 http2去掉 保留这行
        server_name dashboard.nezha.example;
        ssl_certificate          /data/letsencrypt/fullchain.pem; # 你的域名证书路径
        ssl_certificate_key      /data/letsencrypt/key.pem;       # 你的域名私钥路径
        ssl_stapling on;
        ssl_session_timeout 1d;
        ssl_session_cache shared:SSL:10m; # 此项可能会和其他配置文件冲突，如冲突请注释此项
        ssl_protocols TLSv1.2 TLSv1.3;

        underscores_in_headers on;
        set_real_ip_from 0.0.0.0/0; # 修改为你的CDN回源IP地址段
        real_ip_header CF-Connecting-IP; # 修改为你的CDN提供的私有header，此处为CloudFlare默认的
        location ^~ /proto.NezhaService/ {
            grpc_set_header Host $host;
            grpc_set_header nz-realip $http_CF_Connecting_IP; # 修改为你的CDN提供的私有header，此处为CloudFlare默认的
            grpc_read_timeout 300s;
            grpc_send_timeout 300s;
            grpc_socket_keepalive on;
            grpc_pass grpc://dashboard;
        }
        location / {
            proxy_set_header Host $host;
            proxy_set_header Origin https://$host;
            proxy_set_header nz-realip $http_CF_Connecting_IP;  # 修改为你的CDN提供的私有header，此处为CloudFlare默认的
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_read_timeout 3600s;
            proxy_send_timeout 3600s;
            proxy_pass http://dashboard;
        }
    }
    upstream dashboard {
        server localhost:8008;
        keepalive 512;
    }
    ```

- Caddy 配置 示例

    ```
    dashboard.nezha.example {
        @grpcProto {
            path /proto.NezhaService/*
        }
        reverse_proxy @grpcProto {
            header_up Host {host}
            header_up nz-realip {http.CF-Connecting-IP} # 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认的
            transport http {
                versions h2c
                read_buffer 4096
            }
            to localhost:8008
        }

        reverse_proxy {
            header_up Host {host}
            header_up Origin https://{host}
            header_up nz-realip {http.CF-Connecting-IP} # 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认的
            header_up Upgrade {http.upgrade}
            header_up Connection "upgrade"
            transport http {
                read_buffer 16384
            }
            to localhost:8008
        }
    }

    ```